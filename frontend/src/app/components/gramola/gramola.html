<div class="background-layer" 
     [style.backgroundImage]="currentTrack ? 'url(' + currentTrack.album.images[0].url + ')' : 'none'">
</div>
<div class="backdrop-overlay"></div>

<div class="gramola-container">
  
  <header class="glass-header">
    <div class="brand">
      <div class="logo-circle">ğŸµ</div>
      <h1>Gramola<span class="highlight">Virtual</span></h1>
    </div>
    <div class="user-info" *ngIf="usuario">
      <span class="user-badge">{{ usuario.nombre }}</span>
      <button (click)="logout()" class="btn-icon" title="Cerrar sesiÃ³n">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
      </button>
    </div>
  </header>

  <main class="main-content">
    
    <div *ngIf="!spotifyConnected" class="connect-screen fade-in">
      <div class="glass-card connect-card">
        <div class="icon-pulse">ğŸ”Œ</div>
        <h2>SincronizaciÃ³n Requerida</h2>
        <p>Conecta tu cuenta de Spotify Premium para activar el sistema de audio del bar.</p>
        <button (click)="connectSpotify()" class="btn-primary glow">
          <img src="https://storage.googleapis.com/pr-newsroom-wp/1/2018/11/Spotify_Logo_CMYK_Black.png" class="spotify-logo-btn">
          Conectar Ahora
        </button>
      </div>
    </div>

    <div *ngIf="spotifyConnected" class="player-wrapper fade-in">
      
      <section class="now-playing-glass" [class.is-paused]="isPaused">
        <div class="art-container">
          <img *ngIf="currentTrack" [src]="currentTrack.album.images[0].url" class="album-art" alt="Album Art">
          <div *ngIf="!currentTrack" class="album-placeholder">
            <span>ğŸ’¿</span>
          </div>
          <div class="vinyl-record" *ngIf="currentTrack" [class.spinning]="!isPaused"></div>
        </div>

        <div class="track-info-large">
          <div class="status-pill" *ngIf="currentTrack">
            <span class="dot" [class.animate]="!isPaused"></span>
            {{ isPaused ? 'Pausado' : 'Sonando en el local' }}
          </div>
          
          <h2 class="hero-title">
            {{ currentTrack ? currentTrack.name : 'Silencio en la sala' }}
          </h2>
          <p class="hero-artist">
            {{ currentTrack ? currentTrack.artists[0].name : 'AÃ±ade canciones a la cola para empezar' }}
          </p>
          
          <div class="progress-bar-container" *ngIf="currentTrack">
            <div class="progress-bar" [class.animating]="!isPaused"></div>
          </div>
        </div>
      </section>

      <section class="search-section">
        <div class="search-glass">
          <span class="search-icon">ğŸ”</span>
          <input type="text" [(ngModel)]="busqueda" (keyup.enter)="search()" 
                 [disabled]="isSearching"
                 placeholder="Busca tu canciÃ³n favorita..." class="search-input">
          
          <button (click)="search()" class="btn-search" [disabled]="isSearching">
            {{ isSearching ? '...' : 'Buscar' }}
          </button>
        </div>
      </section>

      <div *ngIf="searchResults.length > 0" class="results-overlay fade-in-up">
        <div class="glass-header-results">
          <h3>Resultados de la bÃºsqueda</h3>
          <button class="btn-close" (click)="searchResults = []">âœ•</button>
        </div>
        <div class="results-grid">
          <div class="result-card" *ngFor="let track of searchResults" (click)="anadir(track)">
            <img [src]="track.album.images[1]?.url || track.album.images[0]?.url" class="result-img">
            <div class="result-info">
              <span class="r-title">{{ track.name }}</span>
              <span class="r-artist">{{ track.artists[0].name }}</span>
            </div>
            <div class="result-action">
              <span class="price-tag">0.50 â‚¬</span>
              <button class="btn-add">+</button>
            </div>
          </div>
        </div>
      </div>

      <section class="queue-section">
        <h3 class="section-title">Siguientes en la Cola</h3>
        
        <div *ngIf="colaReproduccion.length === 0" class="empty-state-glass">
          <div class="empty-icon">ğŸ˜´</div>
          <p>La cola estÃ¡ vacÃ­a. Â¡SÃ© el DJ y aÃ±ade algo!</p>
        </div>

        <div class="queue-list" *ngIf="colaReproduccion.length > 0">
          <div class="queue-card fade-in-stagger" *ngFor="let item of colaReproduccion; let i = index">
            <div class="q-index">{{ i + 1 }}</div>
            <div class="q-info">
              <span class="q-title">{{ item.titulo }}</span>
              <span class="q-artist">{{ item.artista }}</span>
            </div>
            <div class="q-status">
              <span class="badge-wait">En espera</span>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>
</div>